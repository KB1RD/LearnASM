<!DOCTYPE html>

<html lang="en">
  <head>
    <title>LearnASM - Editor</title>
    
    <link rel="stylesheet" href="/LearnASM/css/theme.min.css"></link>
    
    <link rel="stylesheet" href="/LearnASM/css/split.css"></link>
    <link rel="stylesheet" href="/LearnASM/css/overlay.css"></link>
    <link rel="stylesheet" href="/LearnASM/css/utils.css"></link>
    
    <script src="/LearnASM/js/lib/jquery.min.js"></script>
    <script src="/LearnASM/js/lib/vue.min.js"></script>
    <script src="/LearnASM/js/lib/popper.min.js"></script>
    <script src="/LearnASM/js/lib/bootstrap.min.js"></script>
    
    <script src="/LearnASM/js/lib/split.min.js"></script>
    
    <script src="/LearnASM/codemirror/lib/codemirror.js"></script>
    <script src="/LearnASM/js/lib/vue-codemirror.js"></script>
    <link rel="stylesheet" href="/LearnASM/codemirror/lib/codemirror.css">
    <link rel="stylesheet" href="/LearnASM/codemirror/theme/mdn-like.css">
    
    <script src="/LearnASM/js/lang/common.js"></script>
    <script src="/LearnASM/js/lang/components.js"></script>
    
    <script src="/LearnASM/js/lang/learn-asm/codemirror-mode.js"></script>
    <script src="/LearnASM/js/lang/learn-asm/lang.js"></script>
  </head>
  
  <body>
    <div id="vue-container">
      <div class="overlay horiz-center-children" id="loading-overlay" style="width: 100%; padding:20px; background-color: rgb(255,255,255);">
        <div style="width: 100%">
          <center id="lbl-requires-js">
            <h1>This website requires JavaScript.</h1>
            <p>sorry...</p>
          </center><br>
          <div id="loading-progress" class="progress" style="width:100%; display:none;">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-info" style="width: 100%; margin: 0 auto;"></div>
          </div><br>
        </div>
      </div>
      
      <notification-overlay :alert_manager="alert_manager"></notification-overlay>
      <options-modal :options="options"></options-modal>
      
      <dialog-modal id="dialog-modal" :title="alert_manager.dialog.title" :body="alert_manager.dialog.body" :btns="alert_manager.dialog.btns"></dialog-modal>
      
      <div id="no-learn-modal" class="modal fade">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Sorry!</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Learn mode is comming soon!</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      
      <custom-navbar :version="version" :links="main_navbar">
        <!-- FILE BUTTON GROUP -->
        <ctrl-file-menu :system="systems.global" :options_modal="'#options-modal'"></ctrl-file-menu>
        
        <ctrl-button-panel :system="systems.global" :global="this"></ctrl-button-panel>
      </custom-navbar>
      
      <div class="content-container">
        <div style="height: 100%">
          <div id="lpane" class="split split-horizontal">
            <div id="apane" class="split content flex-container">
              <core-pane-code :system="systems.global" :activelines="systems.global.active_lines"></core-pane-code>
            </div>
            <div id="bpane" class="split content">
              <core-pane-mem></core-pane-mem>
            </div>
          </div>
          <div id="rpane" class="split split-horizontal">
            <div id="cpane" class="split content">
              <core-pane-io></core-pane-io>
            </div>
            <div id="dpane" class="split content" style="overflow: auto;">
              <component :is="systems.global.visual_component" :cpu="systems.global.cpu"></component>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Core Init -->
    <script type="text/javascript">
        // JS libraries may not have loaded yet
        document.getElementById("lbl-requires-js").style.display = "none";
        document.getElementById("loading-progress").style.display = "";
        
        $(document).ready(function() {
          if(!system_init("global", languages.learnasm)) {
              global.alert_manager.error("Load Error", "Language not found or is corrupt. This is a massive bug.");
          } else {
              var code = cookie_manager.load_json_cookie("code");
              if(typeof code == 'string' || code instanceof String) {
                  global.systems["global"].asm_text = code;
              } else {
                  global.systems["global"].asm_text = global.systems["global"].default_asm_text;
              }
          }
          
          // Vue.JS is loaded AFTER all the systems have been initalized
          core_init();
          
          Split(['#lpane', '#rpane'], {
              gutterSize: 8,
              cursor: 'col-resize'
          });
          Split(['#apane', '#bpane'], {
              direction: 'vertical',
              sizes: [25, 75],
              gutterSize: 8,
              cursor: 'row-resize'
          }).collapse(1);
          Split(['#cpane', '#dpane'], {
              direction: 'vertical',
              sizes: [25, 75],
              gutterSize: 8,
              cursor: 'row-resize'
          }).collapse(0);
        });

        window.addEventListener("beforeunload", function(e){
          cookie_manager.save_json_cookie("code", global.systems["global"].asm_text);
          global.save_options();
        }, false);
        
        load_complete();
        
        function show_no_learn_modal() {
          $("#no-learn-modal").modal('show');
        }
    </script>
  </body>
</html>
